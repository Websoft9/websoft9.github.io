<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>LAMP/LNMP Stack Image Guide</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

    <link rel="stylesheet" type="text/css" href="https://en.websoft9.com/wp-content/plugins/xdocs/themes/theme1/assets/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://en.websoft9.com/wp-content/plugins/xdocs/themes/theme1/assets/css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="https://en.websoft9.com/wp-content/plugins/xdocs/themes/theme1/assets/css/prism.css">
    <link rel="stylesheet" type="text/css" href="https://en.websoft9.com/wp-content/plugins/xdocs/themes/theme1/assets/css/layout.css">
    <link rel="stylesheet" type="text/css" href="https://en.websoft9.com/wp-content/plugins/xdocs/themes/theme1/assets/css/skin-blue.css">

    <link rel="stylesheet" type="text/css" href="https://en.websoft9.com/wp-content/plugins/xdocs/themes/theme1/assets/css/style.css">

    <!-- All dynamic styles -->
        <style type="text/css">
        
    </style>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
              <style>
            .xdocs-pre-loader{
                background: url(https://en.websoft9.com/wp-content/plugins/xdocs/assets/img/loader1.gif) center no-repeat #fff;
            }
        </style>

          </head>
  <body class="skin-blue fixed" data-spy="scroll" data-target="#scrollspy">


    
    <div class="xdocs-pre-loader"></div>    <div class="wrapper">
      <header class="main-header">
          <!-- Sidebar toggle button-->
          <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
            <span class="sr-only">Toggle navigation</span>
          </a>
      </header>
      <!-- Left side column. contains the logo and sidebar --><aside class="main-sidebar">
  <ul class='social'><li><a target='_blank' href='http://en.websoft9.com' ><i class='fa fa-home'></i></a></li><li><a target='_blank' href='http://en.websoft9.com/aboutus/contact/' ><i class='fa fa-envelope'></i></a></li><li><a target='_blank' href='http://en.websoft9.com/support/forum/' ><i class='fa fa-support'></i></a></li></ul>  
  <!-- sidebar: style can be found in sidebar.less -->
  <div class="sidebar" id="scrollspy">
    <!-- sidebar menu: : style can be found in sidebar.less -->
    <ul class="nav sidebar-menu">
      <li class="active"><a href="#introduction">Introduction</a>

                  
                 
                   <li  class="treeview w9-fathermenu-arrow" id="scrollspy-components"><a href="#environment-description">Environment description</a>
                  <ul class="nav treeview-menu"><li class=""><a href="#application-version">Application version</a><li class=""><a href="#application-directories">Application Directories</a><li class=""><a href="#how-to-manage-service">How to manage service</a><li class=""><a href="#default-database-password">Default database password</a><li class=""><a href="#how-to-manage-mysql">How to manage MySQL</a></ul>                </li>

              
              
                             

               <li class=""><a href="#how-to-manage-virtual-host">How to manage virtual host</a>

                    
              
                             

               <li class=""><a href="#how-to-deploy-a-website-on-a-server">How to deploy a website on a server</a>

                    
              
                             

               <li class=""><a href="#proper-permissions-for-files-folders">Proper permissions for files/folders</a>

                    
              
                             

               <li class=""><a href="#how-to-change-your-php-version">How to Change your PHP Version</a>

                    
              
                             

               <li class=""><a href="#how-to-upgrade">How to upgrade</a>

                    
              
                             

               <li class=""><a href="#how-to-uninstall">How to uninstall</a>

                    
              
                             

               <li class=""><a href="#how-to-manage-ftp-user-accounts">How to manage FTP User Accounts</a>

                    
              
                             

               <li class=""><a href="#iptables-firewal">Iptables Firewal</a>

                    
              
                             

               <li class=""><a href="#how-to-add-extensions">How to add Extensions</a>

                    
              
                             

               <li class=""><a href="#php-opcode-cache">PHP opcode cache</a>

                    
              
                             

               <li class=""><a href="#migrating-website-from-os-disk-to-data-disk">Migrating website from OS disk to Data disk</a>

                    
              
                             

               <li class=""><a href="#how-do-use-scripts-to-optimize-the-parameters">How do use scripts to optimize the parameters</a>

                    
              
                             

               <li class=""><a href="#how-to-backup">How to backup</a>

                    
              
            </ul>
          </div>
    </aside>
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Main content -->
    <div class="content body">


         <!-- Introduction Section -->
          <section id="introduction">
            <div class='section-content'>
              <div class="content-header">
                <h1>LAMP/LNMP Stack Image Guide</h1>
                              <div class="version"> Version 1.0.0</div>
                       </div>
              <div class="row">
                <div class="col-sm-12">
                                   </div>
              </div>
              <div class="row">
                  <div class="col-sm-12">
                     <p><strong>This is the user guide of  the software image powered by Websoft9, The Image Including LNMP Stack,LAMP Stack, etc.</strong></p>
<p>For more technical support, please go to <a href="http://en.websoft9.com/support/" target="_blank">http://en.websoft9.com/support</a></p>
                  </div>
              </div>
            </div>
          </section>
          <!-- End Introduction Section -->


  <section id="environment-description" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>Environment description</h2><p>After loading the image,To access, using following URL</p>
<p><strong>http://&lt; Public net IP &gt;</strong></p>
<p>Image Feature:</p>
<p>1. Source compiler installation, download the latest and most stable version from the official, security optimization</p>
<p>2. Providing multiple PHP versions (php-7, php-5.6, php-5.5, php-5.4, php-5.3)</p>
<p>3. jemalloc optimize MySQL</p>
<p>4. Providing add a virtual host script, include Let&#8217;s Encrypt SSL certificate</p>
<p>5. Add ftp acount to nginx via the shell script menu</p>
<p>6. Provide MySQL,PHP, Redis, Memcached,phpMyAdmin upgrade script</p>
<p>7. Provide local backup and remote backup (rsync between servers) 、 Alibaba cloud OSS backup(Intranet) script</p>
<div id='application-version' class='step-content clearfix'><h3 class='steps-header'><a href='#application-version'>Application version</a></h3><p><strong>LNMP 7.0.15/7.0.16:</strong>Nginx1.10.3,PHP7.0.15/7.0.16,MySQL5.6.35,Redis3.2.6,Memcached1.4.34,Jemalloc4.4.0,Pure-FTPd1.0.43,phpMyAdmin4.4.15.9</p>
<p><strong>LAMP 7.0.15/7.0.16:</strong>Apache2.4.23,PHP7.0.15/7.0.16,MySQL5.6.35,Redis3.2.6,Memcached1.4.34,Jemalloc4.4.0,Pure-FTPd1.0.43,phpMyAdmin4.4.15.9</p>
<p><strong>LAMP 5.6.30:</strong>Apache2.4.23,PHP5.6.30,MySQL5.6.35,Redis3.2.6,Memcached1.4.34,Jemalloc4.4.0,Pure-FTPd1.0.43,phpMyAdmin4.4.15.10</p>
</div><div id='application-directories' class='step-content clearfix'><h3 class='steps-header'><a href='#application-directories'>Application Directories</a></h3><p>Nginx install directory: /usr/local/nginx<br />
Apache install directory: /usr/local/apache</p>
<p>Database install directory: /usr/local/mysql or /usr/local/mariadb<br />
Database data directory: /data/mysql or /data/mariadb<br />
Database Configuration File: /etc/my.cnf</p>
<p>PHP install directory: /usr/local/php<br />
PHP Configuration Path: /usr/local/php/etc<br />
PHP Configuration File: /usr/local/php/etc/php.ini<br />
PHP Additional .ini File: /usr/local/php/etc/php.d</p>
<p>Memcached install directory: /usr/local/memcached<br />
Memcached Configuration File: /etc/init.d/memcached</p>
<p>Redis install directory: /usr/local/redis<br />
Redis Configuration File: /usr/local/redis/etc/redis.conf</p>
<p>Web Context document root: /data/wwwroot/default<br />
phpMyAdmin install directory: /data/wwwroot/default/phpMyAdmin<br />
Web logs directory: /data/wwwlogs</p>
<p><strong>The default ip direct access to the contents of the corresponding root directory:/data/wwwroot/default</strong> ，This directory contains the home pagedemo,Opcache Control Panel,phpinfo,phpmyadmin,Probes and other documents，Directory inside the file can be deleted, the directory can not be deleted.</p>
</div><div id='how-to-manage-service' class='step-content clearfix'><h3 class='steps-header'><a href='#how-to-manage-service'>How to manage service</a></h3><p><strong>Nginx:</strong> <em>service nginx {start|stop|status|restart|reload|configtest}</em><br />
MySQL: <em>service mysqld {start|stop|restart|reload|status}</em><br />
PHP: <em>service php-fpm {start|stop|restart|reload|status}    </em><br />
Pure-Ftpd:<em> service pureftpd {start|stop|restart|status}</em><br />
Redis: <em>service redis-server {start|stop|status|restart|reload}</em><br />
Memcached:<em> service memcached {start|stop|status|restart|reload}</em><br />
<strong>Apache:</strong><em><em> service httpd {start|stop|status|restart|reload}</em></em></p>
</div><div id='default-database-password' class='step-content clearfix'><h3 class='steps-header'><a href='#default-database-password'>Default database password</a></h3><p>Get database password command:</p>
<p><em>cd /root/oneinstack<br />
grep dbrootpwd options.conf</em></p>
<p>&nbsp;</p>
<p><strong>default user/password：root/123456</strong></p>
<p>&nbsp;</p>
</div><div id='how-to-manage-mysql' class='step-content clearfix'><h3 class='steps-header'><a href='#how-to-manage-mysql'>How to manage MySQL</a></h3><p>How to manage MySQL: <a href="http://en.websoft9.com/xdocs/manage-mysql%ef%bc%88lnmplamp-image-%ef%bc%89" target="_blank">click here</a>.</p>
</div></div>  </section>

  <section id="how-to-manage-virtual-host" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>How to manage virtual host</h2><p><strong>How to add a virtual host</strong></p>
<p><em>cd   /root/oneinstack             </em><br />
<em>./vhost.sh  </em>                              #NOTE: If no SSL certificate is purchased，SSL under Nginx please<br />
<a href="http://libs.websoft9.com/Websoft9/DocsPicture/en/common/before1.png" target="_blank"><img class="alignnone size-medium wp-image-16689" src="http://libs.websoft9.com/Websoft9/DocsPicture/en/common/before1.png" alt="before1" /></a><br />
<strong>How to delete a virtual host</strong></p>
<p><em>cd   /root/oneinstack         </em><br />
<em>./vhost.sh del </em></p>
</div>  </section>

  <section id="how-to-deploy-a-website-on-a-server" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>How to deploy a website on a server</h2><ol>
<li>Create the database required for the site</li>
<li>Add a virtual host</li>
<li>Create an FTP account           #Remote upload file recommended to install graphical tools:WinSCP</li>
<li>Deploy the code to the site root directory            #NOTE:Ftp upload code do not need to modify permissions，default is already www; Download the code in server , you must modify the site root and subdirectories,Directory file permissions are www; If there is a problem with site permissions</li>
</ol>
<p>&nbsp;</p>
</div>  </section>

  <section id="proper-permissions-for-files-folders" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>Proper permissions for files/folders</h2><p>Web site root permissions to follow:<br />
file 644， folder 755 ，Permissions Users and groups www<br />
If there is a file permissions problem, execute the following three commands:</p>
<p><em>chown -R www.www /data/wwwroot/<br />
find /data/wwwroot/ -type d -exec chmod 755 {} \;<br />
find /data/wwwroot/ -type f -exec chmod 644 {} \;</em></p>
</div>  </section>

  <section id="how-to-change-your-php-version" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>How to Change your PHP Version</h2><p><em>cd /root/oneinstack </em> #Must enter the directory execution under oneinstack<br />
<em>./change_php_version.sh </em> #Do not sh change_php_version.sh such execution</p>
</div>  </section>

  <section id="how-to-upgrade" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>How to upgrade</h2><p><em>cd /root/oneinstack<br />
./upgrade.sh</em></p>
</div>  </section>

  <section id="how-to-uninstall" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>How to uninstall</h2><p>Some items can be uninstalled separately, such as RDS database, the database can be uninstalled separately</p>
<p><em>cd /root/oneinstack<br />
./uninstall.sh </em> # NOTE: Please backup your data</p>
</div>  </section>

  <section id="how-to-manage-ftp-user-accounts" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>How to manage FTP User Accounts</h2><p><em>cd /root/oneinstack<br />
./pureftpd_vhost.sh</em>                 #Do not sh pureftpd_vhost.sh such execution</p>
</div>  </section>

  <section id="iptables-firewal" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>Iptables Firewal</h2><p><strong>By default, 22 is enabled （ssh）80,443（Nginx） 21,20000:30000（FTP）</strong></p>
<p>Other ports are rejected，If you need to allow other ports, please operate（open 8080 port）, command:</p>
<p><em>iptables -I INPUT 4 -p tcp -m state &#8211;state NEW -m tcp &#8211;dport 8080  -j ACCEPT<br />
service iptables save</em></p>
</div>  </section>

  <section id="how-to-add-extensions" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>How to add Extensions</h2><p><em>cd /root/oneinstack<br />
./addons.sh  </em>                               #NOTE: Support install and uninstall function</p>
</div>  </section>

  <section id="php-opcode-cache" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>PHP opcode cache</h2><p>by default,in order to reduce PHP compile time,improve performance（Opcache is recommended for production environments）,The PHP environment loads the Opcache module by default（PHP5.5,5.6,7.0）,But this will appear PHP code updates, take 2 to 3 minutes to take effect，This affects the efficiency of the site during the commissioning phase suggest that you close or refresh the cache every time there is a code update（Recommended method two）</p>
<p><strong>Method 1:Uninstall Opcache</strong></p>
<p><em>cd /root/oneinstack<br />
./addons.sh</em></p>
<p>&nbsp;</p>
<p><strong>Method 2: Refresh the PHP cache</strong></p>
<p>Access <em>http://&lt; Public net IP &gt;/ocp.php</em>，<br />
Or direct access <em>http://&lt; Public net IP &gt;/ocp.php/ocp.php?RESET=1</em></p>
</div>  </section>

  <section id="migrating-website-from-os-disk-to-data-disk" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>Migrating website from OS disk to Data disk</h2><p>Note:If you purchased a data disk（And only one data disk），It is recommended to mount the data disk first，the site content, database storage data cloud disk，If there is no purchase data cloud disk Ignore the tutorial！</p>
<p><em>cd /root/oneinstack </em>                 #Must enter the directory execution under oneinstack<br />
<em>./move_auto_fdisk.sh</em>               #mount data disk and migrate</p>
</div>  </section>

  <section id="how-do-use-scripts-to-optimize-the-parameters" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>How do use scripts to optimize the parameters</h2><p>Because this image was build based on 1 Core 1G ECS,the configuration and parameters for MySQL/MariaDB,PHP are original without any change, highly recommended If this is not the case, run the following optimization script:</p>
<p><em>cd /root/oneinstack<br />
./optimize.sh   </em>                      #Do not sh optimize.sh or bash optimize.sh such execution</p>
<p>NOTE:<br />
1. It may take 1 minute, do not interrupt<br />
2. This script will automatically optimize MySQL, PHP and other parameters according to the system configuration</p>
</div>  </section>

  <section id="how-to-backup" class="stickem-container">
  <div class='section-content'><h2 class='page-header'>How to backup</h2><p><em>cd /root/oneinstack               </em><br />
<em>./backup_setup.sh      </em></p>
<p><strong>Perform the backup immediately:</strong>：<br />
<em>cd /root/oneinstack      </em><br />
<em>./backup.sh              </em></p>
<p>Set Scheduled Task Automatic Scheduled Backup:<br />
Example:Can be added to scheduled tasks, such as automatic backups every day 1:00<br />
# <em>echo &#8216;0 1 * * * cd ~/oneinstack;./backup.sh &gt; /dev/null 2&gt;&amp;1 &amp; &#8216; &gt;&gt; /var/spool/cron/root</em></p>
<p><strong>View the backup: </strong><br />
View the local backup:<br />
<em>ls -l /data/backup/</em></p>
</div>  </section>

    </div><!-- /.content -->
</div><!-- /.content-wrapper -->
      

  <footer class="main-footer">

      <div class="pull-right hidden-xs">
                        <div class="version"> Version 1.0.0</div>
               </div>

    <div class="copyrights">Websoft9</div>  </footer>


</div><!-- ./wrapper -->


    <script type="text/javascript" src="https://en.websoft9.com/wp-content/plugins/xdocs/themes/theme1/assets/js/jQuery-2.2.0.min.js"></script>
    <script type="text/javascript" src="https://en.websoft9.com/wp-content/plugins/xdocs/themes/theme1/assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://en.websoft9.com/wp-content/plugins/xdocs/themes/theme1/assets/js/app.js"></script>
    <script type="text/javascript" src="https://en.websoft9.com/wp-content/plugins/xdocs/themes/theme1/assets/js/jquery.stickem.js"></script>
    <script type="text/javascript" src="https://en.websoft9.com/wp-content/plugins/xdocs/themes/theme1/assets/js/jquery.slimscroll.min.js"></script>
    <script type="text/javascript" src="https://en.websoft9.com/wp-content/plugins/xdocs/themes/theme1/assets/js/prism.js"></script>
    <script type="text/javascript" src="https://en.websoft9.com/wp-content/plugins/xdocs/themes/theme1/assets/js/docs.js"></script>
    </body>
</html>