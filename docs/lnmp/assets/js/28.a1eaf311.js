(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{217:function(t,e,a){"use strict";a.r(e);var r=a(0),s=Object(r.a)({},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"安装网站"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装网站","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装网站")]),t._v(" "),a("p",[t._v("在 LNMP 环境上安装一个网站，也就是我们常说的增加一个虚拟主机。")]),t._v(" "),a("p",[t._v("全局上看，只需两个步骤："),a("strong",[t._v("上传网站代码")]),t._v(" + "),a("router-link",{attrs:{to:"/zh/stack-components.html#nginx"}},[a("strong",[t._v("虚拟机主机配置文件")])]),t._v(" "),a("strong",[t._v("中增加 server{} 配置段")])],1),t._v(" "),a("blockquote",[a("p",[t._v("server{} 又称之为虚拟主机配置段，每个网站必定在 default.conf 中对应唯一的 server{}。")])]),t._v(" "),a("h2",{attrs:{id:"准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备","aria-hidden":"true"}},[t._v("#")]),t._v(" 准备")]),t._v(" "),a("p",[t._v("安装网站之前，请了解如下几个要点，做好准备工作")]),t._v(" "),a("ul",[a("li",[t._v("虚拟机主机配置文件："),a("em",[t._v("/etc/nginx/conf.d/default.conf")])]),t._v(" "),a("li",[t._v("连接工具：使用 WinSCP 连接服务器，它包含文件管理、运行命令两方面功能")]),t._v(" "),a("li",[t._v("域名：若需要使用域名，请确保备案后的域名成功解析到服务器IP")]),t._v(" "),a("li",[t._v("数据库：网站安装向导过程中可能需要使用数据库，请使用 "),a("router-link",{attrs:{to:"/zh/admin-mysql.html"}},[t._v("phpMyAdmin 管理数据库")])],1)]),t._v(" "),a("p",[t._v("有一个全局认知并完成准备工作之后，我们开始部署网站")]),t._v(" "),a("h2",{attrs:{id:"安装第一个网站"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装第一个网站","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装第一个网站")]),t._v(" "),a("p",[t._v("下面通过"),a("strong",[t._v("替换示例网站")]),t._v("（LNMP 默认存在一个示例网站）的方式来教你安装你的第一个网站：")]),t._v(" "),a("ol",[a("li",[t._v("使用 WinSCP 连接服务器")]),t._v(" "),a("li",[t._v("删除示例网站 "),a("em",[t._v("/data/wwwroot/www.example.com")]),t._v(" 下的所有文件（保留目录）")]),t._v(" "),a("li",[t._v("将本地电脑上的网站源码上传到示例目录下\n"),a("img",{attrs:{src:"https://libs.websoft9.com/Websoft9/DocsPicture/zh/winscp/winscp-uploadcodestoexample-websoft9.png",alt:""}})]),t._v(" "),a("li",[t._v("修改 "),a("em",[t._v("default.conf")]),t._v(" 中已有 server{} 配置段（"),a("router-link",{attrs:{to:"/zh/solution-deployment.html#server"}},[t._v("修改参考")]),t._v("），实现绑定域名、修改网站目录名称等操作。\n"),a("img",{attrs:{src:"https://libs.websoft9.com/Websoft9/DocsPicture/en/lnmp/lnmp-editvhostconf-websoft9.png",alt:""}}),a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("如果不绑定域名、不修改网站目录名称，请跳过步骤4和5")])])],1),t._v(" "),a("li",[t._v("保存 default.conf，然后在 WinSCP 中运行重启服务命令 或 云控制台重启服务器 ："),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 重启 Nginx 服务命令\nsudo systemctl restart nginx\n")])])])]),t._v(" "),a("li",[t._v("本地浏览器访问："),a("em",[t._v("http://域名")]),t._v(" 或 "),a("em",[t._v("http://服务器公网IP")]),t._v(" 即可访问您的网站")])]),t._v(" "),a("h2",{attrs:{id:"安装第二个网站"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装第二个网站","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装第二个网站")]),t._v(" "),a("p",[t._v("从安装第二个网站开始，需要在 "),a("em",[t._v("default.conf")]),t._v(" 中增加对应的虚拟主机配置段，具体如下")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("使用 WinSCP 连接服务器，在 /data/wwwroot 下新建一个网站目录，假设命令为“mysite2”\n"),a("img",{attrs:{src:"https://libs.websoft9.com/Websoft9/DocsPicture/zh/lamp/lamp-createmysite2-websoft9.png",alt:""}})])]),t._v(" "),a("li",[a("p",[t._v("将本地网站源文件上传到："),a("em",[t._v("/data/wwwroot/mysite2")]),t._v(" "),a("img",{attrs:{src:"https://libs.websoft9.com/Websoft9/DocsPicture/zh/lamp/lamp-uploadcodes-websoft9.png",alt:""}})])]),t._v(" "),a("li",[a("p",[t._v("编辑 "),a("em",[t._v("default.conf")]),t._v(" 文件\n"),a("img",{attrs:{src:"https://libs.websoft9.com/Websoft9/DocsPicture/zh/lamp/lamp-editvhostconf-websoft9.png",alt:""}})]),t._v(" "),a("p",[t._v("根据是否通过域名访问，选择下面操作之一：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("有域名，通过 http://域名 访问网站")])])]),t._v(" "),a("p",[t._v("请将下面 server 模板拷贝到 default.conf 中，并修改其中的 server_name, root, error_log, access_log等项的值")]),t._v(" "),a("pre",[a("code",[t._v("```\nserver\n{\n listen 80;\n server_name mysite2.yourdomain.com;\n index index.html index.htm index.php;\n root  /data/wwwroot/mysite2;\n error_log /var/log/nginx/mysite2.yourdomain.com-error.log crit;\n access_log  /var/log/nginx/mysite2.yourdomain.com-access.log;\n include conf.d/extra/*.conf;\n\n ## Includes one of your Rewrite rules if you need, examples\n # include conf.d/rewrite/wordpress.conf;\n # include conf.d/rewrite/joomla.conf;\n }\n ```\n")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("没有域名，通过 http://mysite1.yourdomain.com/mysite2 访问网站")])])]),t._v(" "),a("p",[t._v("请将下面 Alias 模板插入到 default.conf 中已存在的 server{} 段中，并修改其中的 location,alias")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("location /mysite2\n{\n alias /data/wwwroot/mysite2;\n index index.php index.html;\n location ~ ^/mysite2/.+\\.php$ {\n  alias /data/wwwroot/mysite2;\n  fastcgi_pass  unix:/dev/shm/php-fpm-default.sock;\n  fastcgi_index  index.php;\n  fastcgi_param  SCRIPT_FILENAME /data/wwwroot/$fastcgi_script_name;\n  include        fastcgi_params; }\ninclude conf.d/extra/*.conf;\n}\n")])])]),a("p",[a("img",{attrs:{src:"https://libs.websoft9.com/Websoft9/DocsPicture/en/lnmp/lnmp-insertalias-websoft9.png",alt:""}})]),t._v(" "),a("p",[t._v("注意：Alias 模板只能插入到 server{} 配置段中")])]),t._v(" "),a("li",[a("p",[t._v("保存 "),a("em",[t._v("default.conf")]),t._v("，然后在 WinSCP 中运行重启服务命令 或 云控制台重启服务器 ：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 重启Nginx服务命令\nsudo systemctl restart nginx\n")])])])]),t._v(" "),a("li",[a("p",[t._v("如果配置了域名，通过："),a("em",[t._v("http://域名")]),t._v(" 访问你的网站。")])]),t._v(" "),a("li",[a("p",[t._v("如果没有配置域名，通过："),a("em",[t._v("http://mysite1.yourdomain.com/mysite2")]),t._v(" 访问你的网站")])])]),t._v(" "),a("h2",{attrs:{id:"安装第-n-个网站"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装第-n-个网站","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装第 N 个网站")]),t._v(" "),a("p",[t._v("安装第n个网站与安装第二个网站的操作步骤一模一样")]),t._v(" "),a("p",[t._v("最后我们温故而知新，总结 LNMP 安装网站步骤：")]),t._v(" "),a("ol",[a("li",[t._v("上传网站代码")]),t._v(" "),a("li",[t._v("绑定域名（非必要）")]),t._v(" "),a("li",[t._v("新增站点配置或修改示例站点配置")]),t._v(" "),a("li",[t._v("增加网站对应的数据库（非必要）")]),t._v(" "),a("li",[t._v("进入安装向导")])]),t._v(" "),a("h2",{attrs:{id:"server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#server","aria-hidden":"true"}},[t._v("#")]),t._v(" Server")]),t._v(" "),a("p",[t._v("server{ } 改动务必准确无误，任何错误的修改都会导致服务器上所有的网站不可访问")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("server 项")]),t._v(" "),a("th",[t._v("作用说明")]),t._v(" "),a("th",[t._v("必要性")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("server_name")]),t._v(" "),a("td",[t._v("域名，如果配置两个域名需以空格分开")]),t._v(" "),a("td",[t._v("必须填写")])]),t._v(" "),a("tr",[a("td",[t._v("root")]),t._v(" "),a("td",[t._v("网站存放目录")]),t._v(" "),a("td",[t._v("务必准确无误")])]),t._v(" "),a("tr",[a("td",[t._v("error_log")]),t._v(" "),a("td",[t._v("错误日志路径，系统会根据定义的路径产生相关日志文件")]),t._v(" "),a("td",[t._v("可以不填或删除")])]),t._v(" "),a("tr",[a("td",[t._v("access_log")]),t._v(" "),a("td",[t._v("访问日志路径，系统会根据定义的路径产生相关日志文件")]),t._v(" "),a("td",[t._v("可以不填或删除")])]),t._v(" "),a("tr",[a("td",[t._v("ssl_certificate")]),t._v(" "),a("td",[t._v("HTTPS 证书路径")]),t._v(" "),a("td",[t._v("设置 HTTPS 访问时必填")])]),t._v(" "),a("tr",[a("td",[t._v("ssl_certificate_key")]),t._v(" "),a("td",[t._v("HTTPS 证书秘钥路径")]),t._v(" "),a("td",[t._v("设置 HTTPS 访问时必填")])])])]),t._v(" "),a("h2",{attrs:{id:"常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见问题","aria-hidden":"true"}},[t._v("#")]),t._v(" 常见问题")]),t._v(" "),a("h4",{attrs:{id:"访问刚安装的网站，页面显示-“没有权限-”-？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问刚安装的网站，页面显示-“没有权限-”-？","aria-hidden":"true"}},[t._v("#")]),t._v(" 访问刚安装的网站，页面显示 “没有权限...” ？")]),t._v(" "),a("p",[t._v("运行一条修改文件权限的命令")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("chown -R nginx.nginx /data/wwwroot\n")])])]),a("h4",{attrs:{id:"修改-default-conf-文件之后，nginx-服务无法启动？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改-default-conf-文件之后，nginx-服务无法启动？","aria-hidden":"true"}},[t._v("#")]),t._v(" 修改 default.conf 文件之后，Nginx 服务无法启动？")]),t._v(" "),a("p",[t._v("一般是 server{ } 中虚拟主机的目录位置不正确导致")]),t._v(" "),a("h4",{attrs:{id:"新增网站不可访问，且导致其他网站都不可访问？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增网站不可访问，且导致其他网站都不可访问？","aria-hidden":"true"}},[t._v("#")]),t._v(" 新增网站不可访问，且导致其他网站都不可访问？")]),t._v(" "),a("p",[t._v("一般是 server{ } 中虚拟主机的目录位置不正确导致 Nginx 无法启动")]),t._v(" "),a("h4",{attrs:{id:"打开新增的网站，显示404错误？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打开新增的网站，显示404错误？","aria-hidden":"true"}},[t._v("#")]),t._v(" 打开新增的网站，显示404错误？")]),t._v(" "),a("p",[t._v("一般是网站目录下没有 index.php 或 index.html 等默认首页导致")]),t._v(" "),a("h4",{attrs:{id:"新增的网站，显示-500-internal-server-error？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新增的网站，显示-500-internal-server-error？","aria-hidden":"true"}},[t._v("#")]),t._v(" 新增的网站，显示 500 Internal Server Error？")]),t._v(" "),a("p",[t._v("程序代码错误，需要查看程序的日志文件")])])},[],!1,null,null,null);e.default=s.exports}}]);