(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{224:function(t,r,e){"use strict";e.r(r);var s=e(28),o=Object(s.a)({},(function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"可视化工具-portainer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#可视化工具-portainer"}},[t._v("#")]),t._v(" 可视化工具 Portainer")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://www.portainer.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Portainer"),e("OutboundLink")],1),t._v(" 是一个可视化的Docker操作界面，提供状态显示面板、应用模板快速部署、容器镜像网络数据卷的基本操作（包括上传下载镜像，创建容器等操作）、事件日志显示、容器控制台操作、Swarm集群和服务等集中管理和操作、登录用户管理和控制等功能。功能十分全面，基本能满足中小型单位对容器管理的全部需求。")]),t._v(" "),e("h2",{attrs:{id:"登录-portainer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#登录-portainer"}},[t._v("#")]),t._v(" 登录 Portainer")]),t._v(" "),e("p",[t._v("如果你部署了包含 Portainer 的Docker环境，请直接登录使用。否则，请先安装 Portainer：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#通过命令安装 Portainer\n\ndocker volume create portainer_data\ndocker run -d -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer\ncd /usr/libexec/docker/\nsudo ln -s docker-runc-current docker-runc\n")])])]),e("ol",[e("li",[e("p",[t._v("通过本地浏览器访问："),e("em",[t._v("http://服务器公网IP:9000")]),t._v("， 直接进入 Portainer 界面\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/docker/portainer/portainer-login-websoft9.png",alt:""}})])]),t._v(" "),e("li",[e("p",[t._v("设置管理员账号密码，点击【Create user】")])]),t._v(" "),e("li",[e("p",[t._v("选择【Local】作为镜像连接选项，然后点击【Connect】\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/docker/portainer/portainer-loginconnect-websoft9.png",alt:""}})])]),t._v(" "),e("li",[e("p",[t._v("进入Portainer后台管理界面，点击Local项目就可以开始使用Portainer\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/docker/portainer/portainer-bkselect-websoft9.png",alt:""}})])])]),t._v(" "),e("h2",{attrs:{id:"部署mysql容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署mysql容器"}},[t._v("#")]),t._v(" 部署MySQL容器")]),t._v(" "),e("p",[t._v("下面详细介绍通过 Portainer 部署MySQL：")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("登录 Portainer ，打开【Containers】>【Add container】\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-addcontainer-websoft9.png",alt:"createcontainer"}})])]),t._v(" "),e("li",[e("p",[t._v("设置容器运行所需的参数（下面示图并描述重点设置部分）"),e("br"),t._v(" "),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-mysql-websoft9.png",alt:""}})]),t._v(" "),e("ul",[e("li",[t._v("Name 为自定义的容器名称")]),t._v(" "),e("li",[t._v('Image 为容器镜像名称，例如"mysql:5.6" 系统会自动到'),e("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("DockerHub"),e("OutboundLink")],1),t._v("中拉取MySQL5.6")]),t._v(" "),e("li",[t._v("Network ports configuration：建议开启【Publish all exposed network ports...】 以保证容器中的服务可以通过服务器端口被外界访问。如果不开启，需手工建立准确的映射关系("),e("strong",[t._v("难度系数有点高")]),t._v(")。")]),t._v(" "),e("li",[t._v("Env 环境变量设置：添加如所示的容器环境变量，对于MySQL镜像来说，数据库 root 密码"),e("strong",[t._v("MySQL_ROOT_PASSWORD")]),t._v(" 为必填变量，其他更多可选变量查看 "),e("a",{attrs:{href:"https://hub.docker.com/_/mysql",target:"_blank",rel:"noopener noreferrer"}},[t._v(" MySQL镜像说明"),e("OutboundLink")],1)]),t._v(" "),e("li",[t._v("Restart policy：建议选择【Always】，使得容器无论在什么情况下停止总会自动重新启动；")])])]),t._v(" "),e("li",[e("p",[t._v("点击 Deploy the container 创建容器；")])]),t._v(" "),e("li",[e("p",[t._v("如果服务器安全组的3306端口已经开放，现在就可以在本地通过远程连接 MySQL 数据库")]),t._v(" "),e("blockquote",[e("p",[t._v("MySQL8远程访问测试失败，报错：Authentication plugin caching_sha_password cannot be loaded...")])])])]),t._v(" "),e("h2",{attrs:{id:"部署wordpress容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署wordpress容器"}},[t._v("#")]),t._v(" 部署WordPress容器")]),t._v(" "),e("p",[t._v("下面详细介绍通过 Portainer 部署WordPress以及使用上一步的MySQL作为数据存储：")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("登录 Portainer ，打开【Containers】>【Add container】\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-addcontainer-websoft9.png",alt:"createcontainer"}})])]),t._v(" "),e("li",[e("p",[t._v("设置容器运行所需的参数（下面示图并描述重点设置部分）"),e("br"),t._v(" "),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-wordpress-websoft9.png",alt:"wordpress"}})]),t._v(" "),e("ul",[e("li",[t._v("Name 为自定义的容器名称")]),t._v(" "),e("li",[t._v('Image 为容器镜像名称，例如"wordpress" 系统会自动到'),e("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("DockerHub"),e("OutboundLink")],1),t._v("中拉取WordPress")]),t._v(" "),e("li",[t._v("Network ports configuration：建议开启【Publish all exposed network ports...】 以保证容器中的服务可以自动匹配服务器端口被外界访问。如果不开启，需手工建立准确的映射关系("),e("strong",[t._v("难度系数有点高")]),t._v(")。")]),t._v(" "),e("li",[t._v("Restart policy：建议选择【Always】，使得容器无论在什么情况下停止总会自动重新启动；")])])]),t._v(" "),e("li",[e("p",[t._v("点击 Deploy the container 创建容器，创建成功后查看映射的服务器端口号；")])]),t._v(" "),e("li",[e("p",[t._v("本地浏览器访问："),e("em",[t._v("http://服务器公网IP：端口")]),t._v(" 即可访问 WordPress 的初始化安装界面\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-startinstall-1-websoft9.png",alt:""}})])]),t._v(" "),e("li",[e("p",[t._v("此处如果你打算使用MySQL容器，数据库主机地址填写的是 "),e("strong",[t._v("服务器公网IP:端口")]),t._v(" "),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-startinstall-2-websoft9.png",alt:""}})])]),t._v(" "),e("li",[e("p",[t._v("数据库验证通过后，系统提示正式“进行安装”\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/wordpress/wordpress-install003-websoft9.png",alt:""}})])])]),t._v(" "),e("h2",{attrs:{id:"进阶实战：nginx-容器实现端口转发"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#进阶实战：nginx-容器实现端口转发"}},[t._v("#")]),t._v(" 进阶实战：Nginx 容器实现端口转发")]),t._v(" "),e("p",[t._v("以上一章节中的 Wordpress 网站作为示例，在 WordPress 部署完成后，需要在浏览器内输入 "),e("em",[t._v("http://公网IP地址：端口")]),t._v(" 的形式访问网站，但我们不加端口就能访问域名，所以这时就要用到 Nginx 的端口转发功能。")]),t._v(" "),e("p",[t._v("要实现这个需求，有三个部署：部署Nginx容器，部署 FileBrowser 容器，")]),t._v(" "),e("h3",{attrs:{id:"部署nginx容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署nginx容器"}},[t._v("#")]),t._v(" 部署Nginx容器")]),t._v(" "),e("p",[t._v("下面详细介绍通过 Portainer 部署 Nginx：")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("登录 Portainer ，打开【Containers】>【Add container】\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-addcontainer-websoft9.png",alt:"createcontainer"}})])]),t._v(" "),e("li",[e("p",[t._v("按照下图创建 Nginx 容器；\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-nginx-1-websoft9.png",alt:"nginx-1"}})])]),t._v(" "),e("li",[e("p",[t._v("回到容器列表，点击刚刚创建的 Nginx 容器，可进入到容器详情页，往下可看到 "),e("strong",[t._v("volueme")]),t._v(" 信息，记录下 "),e("strong",[t._v("/etc/nginx 目录")]),t._v(" 对应的 volume 的值。\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-nginx-volume-websoft9.png",alt:""}})])])]),t._v(" "),e("h3",{attrs:{id:"部署-filebrowser-容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署-filebrowser-容器"}},[t._v("#")]),t._v(" 部署 FileBrowser 容器")]),t._v(" "),e("ol",[e("li",[t._v("进入到 Portainer 页面，选择左边的 "),e("strong",[t._v("App Templates")]),t._v(" 选项，往下找到 "),e("strong",[t._v("File browser")]),t._v(" 容器模板，单击选择；\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-filebrowser-1-websoft9.png",alt:"filebowser-1"}})]),t._v(" "),e("li",[t._v("按照下图创建 File browser 容器；\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-filebrowser-2-websoft9.png",alt:"filebowser-2"}})]),t._v(" "),e("li",[t._v("进入到容器列表，单击刚刚创建的 File browser 容器，点击 "),e("strong",[t._v("Duplicate/Edit")]),t._v(" 按钮，进入到修改容器信息页面；\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-filebrowser-3-websoft9.png",alt:"filebowser-3"}})]),t._v(" "),e("li",[t._v("按照下图，将 File browser 的 volume 值修改为 和 Nginx 的 volume 值相同；\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-filebrowser-4-websoft9.png",alt:"filebowser-4"}})])]),t._v(" "),e("h3",{attrs:{id:"设置-nginx-配置文件实现端口转发"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置-nginx-配置文件实现端口转发"}},[t._v("#")]),t._v(" 设置 Nginx 配置文件实现端口转发")]),t._v(" "),e("ol",[e("li",[t._v("打开第二步中创建的 File Browser 网站（"),e("a",{attrs:{href:""}},[t._v("公网ip:端口")]),t._v("），账号密码为 "),e("strong",[t._v("admin/admin")]),t._v("，登录到 File Browser;\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-filebrowser-5-websoft9.png",alt:""}})]),t._v(" "),e("li",[t._v("进入 "),e("strong",[t._v("conf.d")]),t._v(" 目录，双击 "),e("strong",[t._v("default.conf")]),t._v(" 文件，将原来的配置删除，修改为如下图所示内容："),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('upstream wordpress {\n    server 159.138.6.145:32773;\n}\n\nserver {\n    listen 80;\n    server_name  test.example.top; #绑定域名\n\n    location / {\n    proxy_pass http://wordpress;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header Via "nginx";\n    }\n}\n')])])]),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-nginx-2-websoft9.png",alt:""}}),t._v(" "),e("blockquote",[e("p",[t._v("[danger] 注意：请将 "),e("strong",[t._v("server_name")]),t._v(" 改为自己的域名，"),e("strong",[t._v("proxy_pass")]),t._v(" 改为自己网站容器的 "),e("strong",[t._v("IP:端口号")])])])]),t._v(" "),e("li",[t._v("到容器列表重启 Nginx 容器，现在就可以在浏览器地址栏输入域名直接访问自己的网站了。\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-proxysuccess-websoft9.png",alt:""}})])]),t._v(" "),e("blockquote",[e("p",[t._v("修改完 Nginx 的配置文件后，File Browser 容器可选择继续保留使用或删除。")])]),t._v(" "),e("h2",{attrs:{id:"进阶实战：portainer-设置-https"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#进阶实战：portainer-设置-https"}},[t._v("#")]),t._v(" 进阶实战：Portainer 设置 HTTPS")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("参考 "),e("RouterLink",{attrs:{to:"/zh/portainer/solution/filebrowser.html"}},[t._v("安装File Browser容器")]),t._v(" 章节新建 File Browser 容器；")],1),t._v(" "),e("blockquote",[e("p",[t._v("注意设置 File Browser 的 volume 。")])])]),t._v(" "),e("li",[e("p",[t._v("在浏览器打开 File Browser ，新建一个名为 "),e("strong",[t._v("cert")]),t._v(" 文件夹，将证书上传至 cert；\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-ssl-1-websoft9.png",alt:""}})])])]),t._v(" "),e("p",[t._v("3.修改 Nginx 的配置文件,注意将 IP 和域名改成自己的服务器 IP 和域名；")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v('upstream portainer {\nserver 159.138.6.145:9000;\n}\n\nserver {\n    listen 80;\n    listen 443 ssl;\n    server_name  test.websoft9.top;\n\n    ssl_certificate /etc/nginx/cert/cert-1540972394298_test.websoft9.top.crt;\n    ssl_certificate_key /etc/nginx/cert/cert-1540972394298_test.websoft9.top.key;\n\n    location / {\n    proxy_pass http://portainer;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header Via "nginx";\n    }\n}\n')])])]),e("p",[e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-ssl-2-websoft9.png",alt:""}})]),t._v(" "),e("blockquote",[e("p",[t._v("[warning] 如果证书路径和图中不同，请将图中证书路径改为自己的证书所在路径，并将证书名改为自己的证书名。")])]),t._v(" "),e("ol",{attrs:{start:"4"}},[e("li",[e("p",[t._v("在容器列表中重启 Nginx 容器使配置生效，就可以在浏览器内使用 https://域名 访问 Portainer 了。")])]),t._v(" "),e("li",[e("p",[t._v("如果想要达到访问 http 自动跳转到 https 的效果，请将配置改成如下所示：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[t._v(' upstream portainer {\n server 159.138.6.145:9000;\n }\n\n server {\n     listen 80;\n     listen 443 ssl;\n     server_name  test.websoft9.top;\n\n ssl_certificate /etc/nginx/cert/cert-1540972394298_test.websoft9.top.crt;\n ssl_certificate_key /etc/nginx/cert/cert-1540972394298_test.websoft9.top.key;\n \n if ($scheme != "https") {\n return 301 https://$host$request_uri;\n }\n\n location / {\n proxy_pass http://portainer;\n proxy_set_header Host $host;\n proxy_set_header X-Real-IP $remote_addr;\n proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n proxy_set_header Via "nginx";\n }\n }\n')])])])])]),t._v(" "),e("h2",{attrs:{id:"技巧"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#技巧"}},[t._v("#")]),t._v(" 技巧")]),t._v(" "),e("h3",{attrs:{id:"portainer-运行容器内部命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#portainer-运行容器内部命令"}},[t._v("#")]),t._v(" Portainer 运行容器内部命令")]),t._v(" "),e("p",[t._v("在此以连接到 MySQL 容器为例进行说明：")]),t._v(" "),e("ol",[e("li",[t._v("返回到容器列表，点击下图中 MySQL 的 "),e("strong",[t._v("Quick actions")]),t._v(" 一栏下的 "),e("strong",[t._v(">_")]),t._v(" 图标；\n"),e("img",{attrs:{src:"http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-containerlist-websoft9.png",alt:""}})]),t._v(" "),e("li",[t._v("在新打开的页面，点击 "),e("strong",[t._v("Connetc")]),t._v(" 按钮，连接到容器；\n"),e("img",{attrs:{src:"http://libs-websoft9-com.oss-cn-qingdao.aliyuncs.com/Websoft9/DocsPicture/zh/potainer/portainer-createdatabase-websoft9.png",alt:""}})]),t._v(" "),e("li",[t._v("接下来就可以在命令窗口中输入"),e("code",[t._v('mysql -uroot -ppassword;"')]),t._v(",其中 “password” 为您在自己设置的数据库密码，这样就可以开始使用数据库命令对 MySQL 进行管理了；")])]),t._v(" "),e("h3",{attrs:{id:"portainer-备份"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#portainer-备份"}},[t._v("#")]),t._v(" Portainer 备份")]),t._v(" "),e("p",[t._v("到 Portainer 的容器列表里面查看 portainer 的 volume 对应的服务器目录，在"),e("code",[t._v("/var/lib/docker/volumes")]),t._v("下可找到 volume 对应的目录名，将其备份即可。")]),t._v(" "),e("h3",{attrs:{id:"portainer-升级"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#portainer-升级"}},[t._v("#")]),t._v(" Portainer 升级")]),t._v(" "),e("p",[t._v("只需运行 "),e("code",[t._v("docker pull portainer")]),t._v("就可以将 Portainer 升级到最新版本。")]),t._v(" "),e("h3",{attrs:{id:"portaniner-绑定域名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#portaniner-绑定域名"}},[t._v("#")]),t._v(" Portaniner 绑定域名")]),t._v(" "),e("p",[t._v("域名绑定可在 "),e("RouterLink",{attrs:{to:"/zh/solution-portainer.html#设置-nginx-配置文件实现端口转发"}},[t._v("配置Nginx实现端口转发")]),t._v(" 章节中将 server_name 改成自己的域名即可。")],1),t._v(" "),e("h2",{attrs:{id:"常见问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[t._v("#")]),t._v(" 常见问题")]),t._v(" "),e("h4",{attrs:{id:"不知道容器镜像所需的端口怎么办？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#不知道容器镜像所需的端口怎么办？"}},[t._v("#")]),t._v(" 不知道容器镜像所需的端口怎么办？")]),t._v(" "),e("p",[t._v("建议开启【Publish all exposed network ports...】 以保证容器中的服务可以自动匹配服务器端口被外界访问。如果不开启，需自行到"),e("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("DockerHub"),e("OutboundLink")],1),t._v("网站查看端口。")]),t._v(" "),e("h4",{attrs:{id:"容器的端口与服务器的端口有什么区别？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#容器的端口与服务器的端口有什么区别？"}},[t._v("#")]),t._v(" 容器的端口与服务器的端口有什么区别？")]),t._v(" "),e("p",[t._v("容器端口需要通过服务器端口做映射，才可以被互联网用户访问。")])])}),[],!1,null,null,null);r.default=o.exports}}]);