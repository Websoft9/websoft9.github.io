<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>可视化工具 Portainer | Docker 管理员手册</title>
    <meta name="description" content="本文档由 Websoft9 公司提供，用于指导用户学习 Docker 的安装部署与基本运维技术，包括：部署、初始化安装、环境配置、HTTPS、SMTP、备份升级和连接云服务器操作等基本操作。">
    <link rel="icon" href="/docs/docker/favcon.ico">
    
    <link rel="preload" href="/docs/docker/assets/css/0.styles.b9c380a7.css" as="style"><link rel="preload" href="/docs/docker/assets/js/app.1fab322a.js" as="script"><link rel="preload" href="/docs/docker/assets/js/2.e837c21b.js" as="script"><link rel="preload" href="/docs/docker/assets/js/25.6a65636d.js" as="script"><link rel="prefetch" href="/docs/docker/assets/js/10.723e8848.js"><link rel="prefetch" href="/docs/docker/assets/js/11.efa0a467.js"><link rel="prefetch" href="/docs/docker/assets/js/12.e3f79872.js"><link rel="prefetch" href="/docs/docker/assets/js/13.ce546f49.js"><link rel="prefetch" href="/docs/docker/assets/js/14.e2b35c5b.js"><link rel="prefetch" href="/docs/docker/assets/js/15.e634f1c1.js"><link rel="prefetch" href="/docs/docker/assets/js/16.a0680017.js"><link rel="prefetch" href="/docs/docker/assets/js/17.8afe033f.js"><link rel="prefetch" href="/docs/docker/assets/js/18.e65a64b7.js"><link rel="prefetch" href="/docs/docker/assets/js/19.4abb7963.js"><link rel="prefetch" href="/docs/docker/assets/js/20.977c3180.js"><link rel="prefetch" href="/docs/docker/assets/js/21.ed986c3b.js"><link rel="prefetch" href="/docs/docker/assets/js/22.76fa4605.js"><link rel="prefetch" href="/docs/docker/assets/js/23.8e0b45ee.js"><link rel="prefetch" href="/docs/docker/assets/js/24.9e9f2bac.js"><link rel="prefetch" href="/docs/docker/assets/js/26.0c4d59fa.js"><link rel="prefetch" href="/docs/docker/assets/js/27.acab07e2.js"><link rel="prefetch" href="/docs/docker/assets/js/28.1e8fa0f9.js"><link rel="prefetch" href="/docs/docker/assets/js/29.9c6f2f22.js"><link rel="prefetch" href="/docs/docker/assets/js/3.c7f72694.js"><link rel="prefetch" href="/docs/docker/assets/js/30.d00a3e5c.js"><link rel="prefetch" href="/docs/docker/assets/js/31.e1fe1e6a.js"><link rel="prefetch" href="/docs/docker/assets/js/32.ea4b01b6.js"><link rel="prefetch" href="/docs/docker/assets/js/4.ab96aee7.js"><link rel="prefetch" href="/docs/docker/assets/js/5.ad5c776f.js"><link rel="prefetch" href="/docs/docker/assets/js/6.7410eb94.js"><link rel="prefetch" href="/docs/docker/assets/js/7.2ddd28ed.js"><link rel="prefetch" href="/docs/docker/assets/js/8.5bda38f4.js"><link rel="prefetch" href="/docs/docker/assets/js/9.eb6fd6e2.js">
    <link rel="stylesheet" href="/docs/docker/assets/css/0.styles.b9c380a7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/docker/zh/" class="home-link router-link-active"><!----> <span class="site-name">Docker 管理员手册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/docker/zh/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://support.websoft9.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  支持
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/docker/solution-portainer.html" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/docs/docker/zh/solution-portainer.html" class="nav-link router-link-exact-active router-link-active">中文</a></li></ul></div></div> <a href="https://github.com/Websoft9/ansible-docker" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/docker/zh/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://support.websoft9.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  支持
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/docker/solution-portainer.html" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/docs/docker/zh/solution-portainer.html" class="nav-link router-link-exact-active router-link-active">中文</a></li></ul></div></div> <a href="https://github.com/Websoft9/ansible-docker" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开始</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/docker/zh/" class="sidebar-link">关于</a></li><li><a href="/docs/docker/zh/stack-deployment.html" class="sidebar-link">部署</a></li><li><a href="/docs/docker/zh/stack-installation.html" class="sidebar-link">初始化安装</a></li><li><a href="/docs/docker/zh/stack-components.html" class="sidebar-link">参数</a></li><li><a href="/docs/docker/zh/stack-accounts.html" class="sidebar-link">账号密码</a></li><li><a href="https://support.websoft9.com/docs/faq/zh/tech-instance.html" target="_blank" rel="noopener noreferrer" class="sidebar-link">云服务器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>实践指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/docker/zh/solution-study.html" class="sidebar-link">Docker速学</a></li><li><a href="/docs/docker/zh/solution-portainer.html" class="active sidebar-link">可视化工具 Portainer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#登录-portainer" class="sidebar-link">登录 Portainer</a></li><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#部署mysql容器" class="sidebar-link">部署MySQL容器</a></li><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#部署wordpress容器" class="sidebar-link">部署WordPress容器</a></li><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#进阶实战：nginx-容器实现端口转发" class="sidebar-link">进阶实战：Nginx 容器实现端口转发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#部署nginx容器" class="sidebar-link">部署Nginx容器</a></li><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#部署-filebrowser-容器" class="sidebar-link">部署 FileBrowser 容器</a></li><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#设置-nginx-配置文件实现端口转发" class="sidebar-link">设置 Nginx 配置文件实现端口转发</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#进阶实战：portainer-设置-https" class="sidebar-link">进阶实战：Portainer 设置 HTTPS</a></li><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#技巧" class="sidebar-link">技巧</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#portainer-运行容器内部命令" class="sidebar-link">Portainer 运行容器内部命令</a></li><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#portainer-备份" class="sidebar-link">Portainer 备份</a></li><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#portainer-升级" class="sidebar-link">Portainer 升级</a></li><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#portaniner-绑定域名" class="sidebar-link">Portaniner 绑定域名</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/docker/zh/solution-portainer.html#常见问题" class="sidebar-link">常见问题</a></li></ul></li><li><a href="/docs/docker/zh/solution-backup.html" class="sidebar-link">备份恢复</a></li><li><a href="/docs/docker/zh/solution-upgrade.html" class="sidebar-link">更新升级</a></li><li><a href="/docs/docker/zh/solution-more.html" class="sidebar-link">更多...</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>配置参考</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/docker/zh/admin-services.html" class="sidebar-link">服务启停</a></li><li><a href="https://support.websoft9.com/docs/linux/zh/admin-practices.html" target="_blank" rel="noopener noreferrer" class="sidebar-link">Linux<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/docker/zh/else-faq.html" class="sidebar-link">FAQ</a></li><li><a href="/docs/docker/zh/else-troubleshooting.html" class="sidebar-link">故障处理</a></li><li><a href="/docs/docker/zh/else-reference.html" class="sidebar-link">参考</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="可视化工具-portainer"><a href="#可视化工具-portainer" class="header-anchor">#</a> 可视化工具 Portainer</h1> <p><a href="https://www.portainer.io" target="_blank" rel="noopener noreferrer">Portainer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个可视化的Docker操作界面，提供状态显示面板、应用模板快速部署、容器镜像网络数据卷的基本操作（包括上传下载镜像，创建容器等操作）、事件日志显示、容器控制台操作、Swarm集群和服务等集中管理和操作、登录用户管理和控制等功能。功能十分全面，基本能满足中小型单位对容器管理的全部需求。</p> <h2 id="登录-portainer"><a href="#登录-portainer" class="header-anchor">#</a> 登录 Portainer</h2> <p>如果你部署了包含 Portainer 的Docker环境，请直接登录使用。否则，请先安装 Portainer：</p> <div class="language- extra-class"><pre class="language-text"><code>#通过命令安装 Portainer

docker volume create portainer_data
docker run -d -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer
cd /usr/libexec/docker/
sudo ln -s docker-runc-current docker-runc
</code></pre></div><ol><li><p>通过本地浏览器访问：<em>http://服务器公网IP:9000</em>， 直接进入 Portainer 界面
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/docker/portainer/portainer-login-websoft9.png" alt=""></p></li> <li><p>设置管理员账号密码，点击【Create user】</p></li> <li><p>选择【Local】作为镜像连接选项，然后点击【Connect】
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/docker/portainer/portainer-loginconnect-websoft9.png" alt=""></p></li> <li><p>进入Portainer后台管理界面，点击Local项目就可以开始使用Portainer
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/docker/portainer/portainer-bkselect-websoft9.png" alt=""></p></li></ol> <h2 id="部署mysql容器"><a href="#部署mysql容器" class="header-anchor">#</a> 部署MySQL容器</h2> <p>下面详细介绍通过 Portainer 部署MySQL：</p> <ol><li><p>登录 Portainer ，打开【Containers】&gt;【Add container】
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-addcontainer-websoft9.png" alt="createcontainer"></p></li> <li><p>设置容器运行所需的参数（下面示图并描述重点设置部分）<br> <img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-mysql-websoft9.png" alt=""></p> <ul><li>Name 为自定义的容器名称</li> <li>Image 为容器镜像名称，例如&quot;mysql:5.6&quot; 系统会自动到<a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">DockerHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中拉取MySQL5.6</li> <li>Network ports configuration：建议开启【Publish all exposed network ports...】 以保证容器中的服务可以通过服务器端口被外界访问。如果不开启，需手工建立准确的映射关系(<strong>难度系数有点高</strong>)。</li> <li>Env 环境变量设置：添加如所示的容器环境变量，对于MySQL镜像来说，数据库 root 密码<strong>MySQL_ROOT_PASSWORD</strong> 为必填变量，其他更多可选变量查看 <a href="https://hub.docker.com/_/mysql" target="_blank" rel="noopener noreferrer"> MySQL镜像说明<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>Restart policy：建议选择【Always】，使得容器无论在什么情况下停止总会自动重新启动；</li></ul></li> <li><p>点击 Deploy the container 创建容器；</p></li> <li><p>如果服务器安全组的3306端口已经开放，现在就可以在本地通过远程连接 MySQL 数据库</p> <blockquote><p>MySQL8远程访问测试失败，报错：Authentication plugin caching_sha_password cannot be loaded...</p></blockquote></li></ol> <h2 id="部署wordpress容器"><a href="#部署wordpress容器" class="header-anchor">#</a> 部署WordPress容器</h2> <p>下面详细介绍通过 Portainer 部署WordPress以及使用上一步的MySQL作为数据存储：</p> <ol><li><p>登录 Portainer ，打开【Containers】&gt;【Add container】
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-addcontainer-websoft9.png" alt="createcontainer"></p></li> <li><p>设置容器运行所需的参数（下面示图并描述重点设置部分）<br> <img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-wordpress-websoft9.png" alt="wordpress"></p> <ul><li>Name 为自定义的容器名称</li> <li>Image 为容器镜像名称，例如&quot;wordpress&quot; 系统会自动到<a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">DockerHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中拉取WordPress</li> <li>Network ports configuration：建议开启【Publish all exposed network ports...】 以保证容器中的服务可以自动匹配服务器端口被外界访问。如果不开启，需手工建立准确的映射关系(<strong>难度系数有点高</strong>)。</li> <li>Restart policy：建议选择【Always】，使得容器无论在什么情况下停止总会自动重新启动；</li></ul></li> <li><p>点击 Deploy the container 创建容器，创建成功后查看映射的服务器端口号；</p></li> <li><p>本地浏览器访问：<em>http://服务器公网IP：端口</em> 即可访问 WordPress 的初始化安装界面
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-startinstall-1-websoft9.png" alt=""></p></li> <li><p>此处如果你打算使用MySQL容器，数据库主机地址填写的是 <strong>服务器公网IP:端口</strong> <img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-startinstall-2-websoft9.png" alt=""></p></li> <li><p>数据库验证通过后，系统提示正式“进行安装”
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/wordpress/wordpress-install003-websoft9.png" alt=""></p></li></ol> <h2 id="进阶实战：nginx-容器实现端口转发"><a href="#进阶实战：nginx-容器实现端口转发" class="header-anchor">#</a> 进阶实战：Nginx 容器实现端口转发</h2> <p>以上一章节中的 Wordpress 网站作为示例，在 WordPress 部署完成后，需要在浏览器内输入 <em>http://公网IP地址：端口</em> 的形式访问网站，但我们不加端口就能访问域名，所以这时就要用到 Nginx 的端口转发功能。</p> <p>要实现这个需求，有三个部署：部署Nginx容器，部署 FileBrowser 容器，</p> <h3 id="部署nginx容器"><a href="#部署nginx容器" class="header-anchor">#</a> 部署Nginx容器</h3> <p>下面详细介绍通过 Portainer 部署 Nginx：</p> <ol><li><p>登录 Portainer ，打开【Containers】&gt;【Add container】
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-addcontainer-websoft9.png" alt="createcontainer"></p></li> <li><p>按照下图创建 Nginx 容器；
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-nginx-1-websoft9.png" alt="nginx-1"></p></li> <li><p>回到容器列表，点击刚刚创建的 Nginx 容器，可进入到容器详情页，往下可看到 <strong>volueme</strong> 信息，记录下 <strong>/etc/nginx 目录</strong> 对应的 volume 的值。
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-nginx-volume-websoft9.png" alt=""></p></li></ol> <h3 id="部署-filebrowser-容器"><a href="#部署-filebrowser-容器" class="header-anchor">#</a> 部署 FileBrowser 容器</h3> <ol><li>进入到 Portainer 页面，选择左边的 <strong>App Templates</strong> 选项，往下找到 <strong>File browser</strong> 容器模板，单击选择；
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-filebrowser-1-websoft9.png" alt="filebowser-1"></li> <li>按照下图创建 File browser 容器；
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-filebrowser-2-websoft9.png" alt="filebowser-2"></li> <li>进入到容器列表，单击刚刚创建的 File browser 容器，点击 <strong>Duplicate/Edit</strong> 按钮，进入到修改容器信息页面；
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-filebrowser-3-websoft9.png" alt="filebowser-3"></li> <li>按照下图，将 File browser 的 volume 值修改为 和 Nginx 的 volume 值相同；
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-filebrowser-4-websoft9.png" alt="filebowser-4"></li></ol> <h3 id="设置-nginx-配置文件实现端口转发"><a href="#设置-nginx-配置文件实现端口转发" class="header-anchor">#</a> 设置 Nginx 配置文件实现端口转发</h3> <ol><li>打开第二步中创建的 File Browser 网站（<a href="">公网ip:端口</a>），账号密码为 <strong>admin/admin</strong>，登录到 File Browser;
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-filebrowser-5-websoft9.png" alt=""></li> <li>进入 <strong>conf.d</strong> 目录，双击 <strong>default.conf</strong> 文件，将原来的配置删除，修改为如下图所示内容：<div class="language- extra-class"><pre class="language-text"><code>upstream wordpress {
    server 159.138.6.145:32773;
}

server {
    listen 80;
    server_name  test.example.top; #绑定域名

    location / {
    proxy_pass http://wordpress;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Via &quot;nginx&quot;;
    }
}
</code></pre></div><img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-nginx-2-websoft9.png" alt=""> <blockquote><p>[danger] 注意：请将 <strong>server_name</strong> 改为自己的域名，<strong>proxy_pass</strong> 改为自己网站容器的 <strong>IP:端口号</strong></p></blockquote></li> <li>到容器列表重启 Nginx 容器，现在就可以在浏览器地址栏输入域名直接访问自己的网站了。
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-proxysuccess-websoft9.png" alt=""></li></ol> <blockquote><p>修改完 Nginx 的配置文件后，File Browser 容器可选择继续保留使用或删除。</p></blockquote> <h2 id="进阶实战：portainer-设置-https"><a href="#进阶实战：portainer-设置-https" class="header-anchor">#</a> 进阶实战：Portainer 设置 HTTPS</h2> <ol><li><p>参考 <a href="/docs/docker/zh/portainer/solution/filebrowser.html">安装File Browser容器</a> 章节新建 File Browser 容器；</p> <blockquote><p>注意设置 File Browser 的 volume 。</p></blockquote></li> <li><p>在浏览器打开 File Browser ，新建一个名为 <strong>cert</strong> 文件夹，将证书上传至 cert；
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-ssl-1-websoft9.png" alt=""></p></li></ol> <p>3.修改 Nginx 的配置文件,注意将 IP 和域名改成自己的服务器 IP 和域名；</p> <pre><code>upstream portainer {
server 159.138.6.145:9000;
}

server {
    listen 80;
    listen 443 ssl;
    server_name  test.websoft9.top;

    ssl_certificate /etc/nginx/cert/cert-1540972394298_test.websoft9.top.crt;
    ssl_certificate_key /etc/nginx/cert/cert-1540972394298_test.websoft9.top.key;

    location / {
    proxy_pass http://portainer;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Via &quot;nginx&quot;;
    }
}
</code></pre> <p><img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-ssl-2-websoft9.png" alt=""></p> <blockquote><p>[warning] 如果证书路径和图中不同，请将图中证书路径改为自己的证书所在路径，并将证书名改为自己的证书名。</p></blockquote> <ol start="4"><li><p>在容器列表中重启 Nginx 容器使配置生效，就可以在浏览器内使用 https://域名 访问 Portainer 了。</p></li> <li><p>如果想要达到访问 http 自动跳转到 https 的效果，请将配置改成如下所示：</p> <pre><code> upstream portainer {
 server 159.138.6.145:9000;
 }

 server {
     listen 80;
     listen 443 ssl;
     server_name  test.websoft9.top;

 ssl_certificate /etc/nginx/cert/cert-1540972394298_test.websoft9.top.crt;
 ssl_certificate_key /etc/nginx/cert/cert-1540972394298_test.websoft9.top.key;
 
 if ($scheme != &quot;https&quot;) {
 return 301 https://$host$request_uri;
 }

 location / {
 proxy_pass http://portainer;
 proxy_set_header Host $host;
 proxy_set_header X-Real-IP $remote_addr;
 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
 proxy_set_header Via &quot;nginx&quot;;
 }
 }
</code></pre></li></ol> <h2 id="技巧"><a href="#技巧" class="header-anchor">#</a> 技巧</h2> <h3 id="portainer-运行容器内部命令"><a href="#portainer-运行容器内部命令" class="header-anchor">#</a> Portainer 运行容器内部命令</h3> <p>在此以连接到 MySQL 容器为例进行说明：</p> <ol><li>返回到容器列表，点击下图中 MySQL 的 <strong>Quick actions</strong> 一栏下的 <strong>&gt;_</strong> 图标；
<img src="http://libs.websoft9.com/Websoft9/DocsPicture/zh/potainer/portainer-containerlist-websoft9.png" alt=""></li> <li>在新打开的页面，点击 <strong>Connetc</strong> 按钮，连接到容器；
<img src="http://libs-websoft9-com.oss-cn-qingdao.aliyuncs.com/Websoft9/DocsPicture/zh/potainer/portainer-createdatabase-websoft9.png" alt=""></li> <li>接下来就可以在命令窗口中输入<code>mysql -uroot -ppassword;&quot;</code>,其中 “password” 为您在自己设置的数据库密码，这样就可以开始使用数据库命令对 MySQL 进行管理了；</li></ol> <h3 id="portainer-备份"><a href="#portainer-备份" class="header-anchor">#</a> Portainer 备份</h3> <p>到 Portainer 的容器列表里面查看 portainer 的 volume 对应的服务器目录，在<code>/var/lib/docker/volumes</code>下可找到 volume 对应的目录名，将其备份即可。</p> <h3 id="portainer-升级"><a href="#portainer-升级" class="header-anchor">#</a> Portainer 升级</h3> <p>只需运行 <code>docker pull portainer</code>就可以将 Portainer 升级到最新版本。</p> <h3 id="portaniner-绑定域名"><a href="#portaniner-绑定域名" class="header-anchor">#</a> Portaniner 绑定域名</h3> <p>域名绑定可在 <a href="/docs/docker/zh/solution-portainer.html#设置-nginx-配置文件实现端口转发">配置Nginx实现端口转发</a> 章节中将 server_name 改成自己的域名即可。</p> <h2 id="常见问题"><a href="#常见问题" class="header-anchor">#</a> 常见问题</h2> <h4 id="不知道容器镜像所需的端口怎么办？"><a href="#不知道容器镜像所需的端口怎么办？" class="header-anchor">#</a> 不知道容器镜像所需的端口怎么办？</h4> <p>建议开启【Publish all exposed network ports...】 以保证容器中的服务可以自动匹配服务器端口被外界访问。如果不开启，需自行到<a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">DockerHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>网站查看端口。</p> <h4 id="容器的端口与服务器的端口有什么区别？"><a href="#容器的端口与服务器的端口有什么区别？" class="header-anchor">#</a> 容器的端口与服务器的端口有什么区别？</h4> <p>容器端口需要通过服务器端口做映射，才可以被互联网用户访问。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Websoft9/ansible-docker/edit/master/docs/zh/solution-portainer.md" target="_blank" rel="noopener noreferrer">在Github上编辑</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/26/2019, 9:25:41 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/docker/zh/solution-study.html" class="prev">Docker速学</a></span> <span class="next"><a href="/docs/docker/zh/solution-backup.html">备份恢复</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/docker/assets/js/app.1fab322a.js" defer></script><script src="/docs/docker/assets/js/2.e837c21b.js" defer></script><script src="/docs/docker/assets/js/25.6a65636d.js" defer></script>
  </body>
</html>
