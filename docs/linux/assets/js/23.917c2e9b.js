(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{188:function(a,t,e){"use strict";e.r(t);var s=e(0),r=Object(s.a)({},function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"apache"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#apache","aria-hidden":"true"}},[a._v("#")]),a._v(" Apache")]),a._v(" "),e("h2",{attrs:{id:"安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),e("h3",{attrs:{id:"安装apache"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装apache","aria-hidden":"true"}},[a._v("#")]),a._v(" 安装Apache")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("# Installing on Fedora/CentOS/Red Hat Enterprise Linux\nsudo yum install httpd\nsudo systemctl enable httpd\nsudo systemctl start httpd\n\n# Installing on Ubuntu/Debian\nsudo apt install apache2\nsudo service apache2 start\n")])])]),e("h3",{attrs:{id:"安装apache模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装apache模块","aria-hidden":"true"}},[a._v("#")]),a._v(" 安装Apache模块")]),a._v(" "),e("h2",{attrs:{id:"工作模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#工作模式","aria-hidden":"true"}},[a._v("#")]),a._v(" 工作模式")]),a._v(" "),e("p",[a._v("Apache工作模式有event,prefork,worker等单重")]),a._v(" "),e("h2",{attrs:{id:"语言支持"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#语言支持","aria-hidden":"true"}},[a._v("#")]),a._v(" 语言支持")]),a._v(" "),e("h3",{attrs:{id:"php"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#php","aria-hidden":"true"}},[a._v("#")]),a._v(" PHP")]),a._v(" "),e("p",[a._v("我们知道Apache被广泛用于PHP环境，Apache有两种PHP处理机制：")]),a._v(" "),e("ul",[e("li",[a._v("php-fpm")]),a._v(" "),e("li",[a._v("mod_php")])]),a._v(" "),e("h3",{attrs:{id:"java"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#java","aria-hidden":"true"}},[a._v("#")]),a._v(" Java")]),a._v(" "),e("h2",{attrs:{id:"配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置","aria-hidden":"true"}},[a._v("#")]),a._v(" 配置")]),a._v(" "),e("h3",{attrs:{id:"配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置文件","aria-hidden":"true"}},[a._v("#")]),a._v(" 配置文件")]),a._v(" "),e("p",[a._v("主配置文件")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("/etc/httpd/conf/httpd.conf\n")])])]),e("p",[a._v("扩展配置文件")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("1./etc/httpd/conf.d/*.conf\n2.当Apache启动时，会加载/etc/httpd/conf.d/目录中的所有以.conf结尾的文件，做为配置文件来使用，所以管理员可以将配置推荐写在.conf中，如果将配置项写入主配置文件，系统升级时，配置项还要重新修改一遍，如果写在扩展配置项，则不存在此问题，同时也可以从繁杂的主配置文件中脱离出来。\n")])])]),e("h3",{attrs:{id:"配置说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置说明","aria-hidden":"true"}},[a._v("#")]),a._v(" 配置说明")]),a._v(" "),e("p",[a._v("ServerTokens OS")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("系统信息,在访问出错时出现;把OS改为Minor,就不显示系统信息\n")])])]),e("p",[a._v("ServerSignature On")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("把On改为Off就连普通的系统都给隐藏起来;改为Email就会显示管理员的邮箱(邮箱需要另外配置 ServerAdmin \n")])])]),e("p",[a._v("ServerAdmin root@localhost")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("管理员邮箱\n")])])]),e("p",[a._v("ServerName localhost")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("服务器的主机名,一般是用虚拟机来设置,通常这个值是自动指定的，推荐显式的指定它以防止启动时出错\n")])])]),e("p",[a._v("UseCanonicalName Off")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('设置为"On",Apache会使用ServerName指令的值\n设置为 "Off"时,Apache会使用用户端提供的主机名和端口号。 \n如果有虚拟主机，必须设置为Off\n')])])]),e("p",[a._v('ServerRoot "/etc/httpd"')]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("配置项的根目录，类似html里面的base;默认到这个路径里面找;\n")])])]),e("p",[a._v("PidFile run/httpd.pid")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("进程PID,位置在 /etc/httpd/run/httpd.pid,主进程决定着子进程  \n")])])]),e("p",[a._v("Timeout 60")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("若60秒后没有收到或送出任何数据就切断该连接\n")])])]),e("p",[a._v("KeepAlive Off")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("是否开启持久化链接,访问网站时要对网站的很多资源,如css,js,image等等创建不同的链接;事实上我们可以建立一个持久化链接来应对多个请求;\n")])])]),e("p",[a._v("MaxKeepAliveRequests 100")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("一个持久化链接最多能应对多少个请求\n")])])]),e("p",[a._v("KeepAliveTimeout 15")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("15秒不链接就断开\n")])])]),e("p",[a._v("Listen 80")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("监听端口,默认是80,一般不同改变;\n\n如果要改变,注意以下几点:\n1. 如果修改为192.168.1.22:8080,表示只能通过192.168.1.22:8080访问\n2. 如果这里要更改为其他端口比如88的话,下面的ServerName localhost:88也得更改(如果是注释掉的,要取消注释)\n3. 如果要监听多个端口,就多写几个Listen\n")])])]),e("p",[a._v("Include conf.d/*.conf")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("扩展配置文件 /etc/httpd/conf.d/\n我们一般在配置文件尾部再加上一句Include conf/vhosts/*.conf,把其他虚拟主机的配置分离开\n")])])]),e("p",[a._v("User apache")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("Apache子进程所有者\n")])])]),e("p",[a._v("Group apache")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("Apache子进程所属组\n")])])]),e("p",[a._v("DirectoryIndex index.html index.html.var")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("默认主文件,\n")])])]),e("p",[a._v('DocumentRoot "/var/www/html"')]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("网站数据根目录。\t\t\n")])])]),e("p",[a._v("ErrorDocument 404 /404.html")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('创建404文件 echo ":) File Not Found!" >/var/www/html/404.html\n404可以通过PHP程序来处理(在框架中),可以通过rewrite来处理,但是最理想的模式是让Apache来处理\t\n')])])]),e("p",[a._v("Directory")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("<Directory />\nOptions Indexes FollowSymLinks\t\t\nAllowOverride None\n</Directory>\n\nDirectory /\n定位目录 /(也就是Apache网站根目录)\n\nIndexes\n如果访问的文件不存在，显示目录文件列表；要禁止的话前面加上一个 - （-indexes）\n\nFollowSymLinks\t\n在目录下创建a.html软链接，\nln -s /ab/index.html  /var/www/html/a.html\nOptions Indexes FollowSymLinks时软链接可用,可以直接在根目录下访问这个软连接\nOptions Indexes –FollowSymLinks软链接不可用\n\nAllowOverride \n是否允许目录配置文件.htaccess有效ALL有效，None无效\n\nOrder allow，deny\nAllow from all\ndeny from 192.168.1.106\n↑↑ 先匹配allow允许，后匹配deny禁止，虽然192.168.1.106满足Allow，但deny是在allow后匹配的，所以192.168.1.106不允许访问\n\nOrder deny,allow\ndeny from all\nallow from 192.168.1.106\n↑↑ 只允许192.168.1.106访问\n")])])]),e("p",[a._v("IfModule")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("如果存在模块mod_userdir.c\n\n<IfModule mod_userdir.c> \nUserDir disabled       #句首加上#号,就表示开启家目录\n#UserDir public_html   #设置家目录的文件夹,在此文件夹里面的文件可以访问得到,前提是有读写权限\n</IfModule>\n\n<Directory /home/*/public_html>\n.*  #跟上面配合,设置可访问家目录的权限\n</Directory>\n")])])]),e("h3",{attrs:{id:"配置注意事项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置注意事项","aria-hidden":"true"}},[a._v("#")]),a._v(" 配置注意事项")]),a._v(" "),e("p",[a._v("1.Apache对文件的操作就会用系统给的一个临时账号Apache作为第三方other来运行,所以要注意ugo的o的权限设置;")]),a._v(" "),e("p",[a._v("2.Apache的配置规则是 "),e("strong",[a._v("后出现,先应用")]),a._v(" 后面的出现的配置会覆盖前面的。")]),a._v(" "),e("p",[a._v("3.以上配置都应该在扩展配置里面覆盖更改或增加;")]),a._v(" "),e("h3",{attrs:{id:"问题：关闭apache-test-page-欢迎页面"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题：关闭apache-test-page-欢迎页面","aria-hidden":"true"}},[a._v("#")]),a._v(" 问题：关闭Apache Test Page 欢迎页面")]),a._v(" "),e("h3",{attrs:{id:"问题：关闭缺省情况目录列表可查看"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题：关闭缺省情况目录列表可查看","aria-hidden":"true"}},[a._v("#")]),a._v(" 问题：关闭缺省情况目录列表可查看")]),a._v(" "),e("p",[a._v("Apache httpd服务器在缺省的情况下，开启了基于目录列表的访问，这是一个存在安全隐患的问题，因此可以关闭这个功能。")]),a._v(" "),e("h2",{attrs:{id:"伪静态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#伪静态","aria-hidden":"true"}},[a._v("#")]),a._v(" 伪静态")]),a._v(" "),e("p",[a._v("使用伪静态有三个步骤：")]),a._v(" "),e("ol",[e("li",[a._v("确保Rewrite模块（apache模块配置文件：/etc/httpd/conf.modules.d/00-base.conf）已经被加载（去掉LoadModule rewrite_module modules/mod_rewrite.so前面的#）。")]),a._v(" "),e("li",[a._v("虚拟主机配置文件中增加AllowOverride All")]),a._v(" "),e("li",[a._v("网站根目录中增加.htaccess文件，并配置伪静态规则")])]),a._v(" "),e("h3",{attrs:{id:"场景：重定向"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#场景：重定向","aria-hidden":"true"}},[a._v("#")]),a._v(" 场景：重定向")]),a._v(" "),e("ol",[e("li",[a._v("开启Apache的rewrite模块")]),a._v(" "),e("li",[a._v("在网站根目录中增加.htaccess文件")])]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("IfModule mod_rewrite.c"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\nRewriteEngine On\nRedirect "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("301")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/empirecmsall-image-guide"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/xdocs/empirecms-image-guide"')]),a._v("\nRedirect "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("301")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/wordpress-image-guide"')]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/xdocs/wordpressold-image-guide"')]),a._v("\n\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("/IfModule"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n")])])]),e("h3",{attrs:{id:"场景：隐藏后缀名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#场景：隐藏后缀名","aria-hidden":"true"}},[a._v("#")]),a._v(" 场景：隐藏后缀名")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("<IfModule mod_rewrite.c>\nRewriteRule ^test$ test.php\nErrorDocument 404 /404.txt\n\n</IfModule>\n\n")])])]),e("h2",{attrs:{id:"虚拟主机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#虚拟主机","aria-hidden":"true"}},[a._v("#")]),a._v(" 虚拟主机")]),a._v(" "),e("p",[a._v("Apahce中的虚拟主机是通过VirtualHost进行配置的")]),a._v(" "),e("h3",{attrs:{id:"http-virtualhost-template"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#http-virtualhost-template","aria-hidden":"true"}},[a._v("#")]),a._v(" HTTP VirtualHost template")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('<VirtualHost *:80>\nServerName www.mydomain.com\nServerAlias other.mydomain.com\nDocumentRoot "/data/wwwroot/zdoo"\nErrorLog "/var/log/httpd/www.mydomain.com_error_apache.log"\nCustomLog "/var/log/httpd/www.mydomain.com_apache.log" common\n<Directory "/data/wwwroot/zdoo">\nOptions Indexes FollowSymlinks\nAllowOverride All\nRequire all granted\n</Directory>\n</VirtualHost>\n')])])]),e("h3",{attrs:{id:"apache-alias-template"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#apache-alias-template","aria-hidden":"true"}},[a._v("#")]),a._v(" Apache Alias template")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('Alias /path /data/wwwroot/zdoo\n<Directory "/data/wwwroot/zdoo">\nOptions Indexes FollowSymlinks\nAllowOverride All\nRequire all granted\n</Directory>\n')])])]),e("h3",{attrs:{id:"apache-https-virtualhost-template"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#apache-https-virtualhost-template","aria-hidden":"true"}},[a._v("#")]),a._v(" Apache HTTPS VirtualHost template")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('<VirtualHost *:443>\nServerName  www.mydomain.com\nDocumentRoot "/data/wwwroot/zdoo"\n#ErrorLog "logs/www.mydomain.com-error_log"\n#CustomLog "logs/www.mydomain.com-access_log" common\n<Directory "/data/wwwroot/zdoo">\nOptions Indexes FollowSymlinks\nAllowOverride All\nRequire all granted\n</Directory>\nSSLEngine on\nSSLCertificateFile  /data/cert/www.mydomain.com.crt\nSSLCertificateKeyFile  /data/cert/www.mydomain.com.key\nSSLCertificateChainFile  /data/cert/root_bundle.crt\n</VirtualHost>\n')])])]),e("h3",{attrs:{id:"默认首页"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#默认首页","aria-hidden":"true"}},[a._v("#")]),a._v(" 默认首页")]),a._v(" "),e("p",[a._v("默认访问目录之时，系统会自动根据顺序寻找列出的页面，并显示其中一个。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('<VirtualHost *:80>\nServerName win.websoft9.com\n<IfModule dir_module>\n  DirectoryIndex index.hmtl defalut.html README.html readme.html about.html\n</IfModule>\nDocumentRoot "/data/wwwroot/default/site"\n...\n')])])]),e("h3",{attrs:{id:"禁用ip访问-防止恶意解析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#禁用ip访问-防止恶意解析","aria-hidden":"true"}},[a._v("#")]),a._v(" 禁用IP访问,防止恶意解析")]),a._v(" "),e("hr"),a._v(" "),e("ol",[e("li",[a._v("给指定网站程序设置域名")]),a._v(" "),e("li",[a._v("将一下内容加入 "),e("code",[a._v("/etc/httpd/conf/httpd.conf")]),a._v(" 的末尾或者在 "),e("code",[a._v("/etc/httpd/conf.d/")]),a._v(" 目录下新建一个 "),e("code",[a._v("deny-ip.conf")]),a._v("的文件将内容写入"),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("<VirtualHost *:80>\n  ServerName 服务器IP地址\n  <Location />\n       Order Allow,Deny\n       Deny from all\n  </Location>\n</VirtualHost>\n\n<VirtualHost *:443>\n   ServerName 服务器IP地址\n   SSLEngine on\n   SSLCertificateFile /etc/pki/tls/certs/localhost.crt\n   SSLCertificateKeyFile /etc/pki/tls/private/localhost.key\n   <Location />\n     Order Allow,Deny\n     Deny from all\n   </Location>\n</VirtualHost>\n")])])])]),a._v(" "),e("li",[a._v("重启 apache\n"),e("code",[a._v("systemctl restart httpd")])])]),a._v(" "),e("h3",{attrs:{id:"访问权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#访问权限","aria-hidden":"true"}},[a._v("#")]),a._v(" 访问权限")]),a._v(" "),e("h2",{attrs:{id:"代理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#代理","aria-hidden":"true"}},[a._v("#")]),a._v(" 代理")]),a._v(" "),e("h2",{attrs:{id:"服务启停"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务启停","aria-hidden":"true"}},[a._v("#")]),a._v(" 服务启停")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("#CentOS or Redhat\nsystemctl start httpd\nsystemctl stop httpd\nsystemctl restart httpd\nsystemctl status httpd\n\n# Ubutnu\nsystemctl start apache2\nsystemctl stop apache2\nsystemctl restart apache2\nsystemctl status apache2\n")])])]),e("h2",{attrs:{id:"日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#日志","aria-hidden":"true"}},[a._v("#")]),a._v(" 日志")]),a._v(" "),e("p",[a._v("Apache 访问日志在实际工作中非常有用，比较典型的例子是进行网站流量统计，查看用户访问时间、地理位置分布、页面点击率等。Apache 的访问日志具有如下4个方面的作用：")]),a._v(" "),e("ul",[e("li",[a._v("记录访问服务器的远程主机IP 地址，从而可以得知浏览者来自何处；")]),a._v(" "),e("li",[a._v("记录浏览者访问的Web资源，可以了解网站中的哪些部分最受欢迎；")]),a._v(" "),e("li",[a._v("记录浏览者使用的浏览器，可以根据大多数浏览者使用的浏览器对站点进行优化；")]),a._v(" "),e("li",[a._v("记录浏览者的访问时间；")])]),a._v(" "),e("h2",{attrs:{id:"缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#缓存","aria-hidden":"true"}},[a._v("#")]),a._v(" 缓存")])])},[],!1,null,null,null);t.default=r.exports}}]);